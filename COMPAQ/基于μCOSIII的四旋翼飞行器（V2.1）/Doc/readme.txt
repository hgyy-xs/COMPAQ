
基于μC/OS III 的四旋翼飞行器
	from 02/04 2016 
硬件平台：STM32F407 mpu6050 ms5611 ks103
软件平台：μC/OS III 

Designer：熊帅
/**
  ******************************************************************************
  * @file 	 FLY_Control_F4
  * @author  hgyy
  * @version V1.1
  * @date    from 07-10-2015  to  13-01-2016
  * @brief   
  *          四轴飞行器飞控程序
  *
  * @bug after before
  *						 1、修复了遥控器roll通道反向的问题
  *						 2、修复起飞后yaw自旋问题
  *						 3、修改遥控各通道的中值为roll 1501 pitch 1519
  *						 4、修改积分清零时刻为throttle < 1300
  *						 5、修改控制周期
  *						 6、修改欧拉角零偏数据
  *
  *				     	 7、修改数据类型MPU6050_Data_TypeDef由int16_t型为float同时修改了MPU6050_OFFSET_TypeDef数据类型为float型
						 8、修改平衡算法，串级PID控制，响应速度更快
						 9、修改My_Ctrl，修复起飞时电机转速不匹配问题
						10、修改rc通道，pitch通道修改为PPM_IN[7]通道，原PB.0被占用，修改为PD.15
  ******************************************************************************
  * @attention
  *					
  * 	飞控程序采用X飞行模式，采用MPU6050的DMP采集姿态数据
  *				
  *				
  *	    飞行模式：	
  *						2      1		
  * 				     \    /			    	 	 
  * 					  \  /				
  *   				   	   ↑   
  *					      /  \							
  *						 /    \						   
  *					    3      4
  *		电机转向：	1号电机 逆时针
  *					2号电机 顺时针
  *					3号电机 逆时针
  *					4号电机 顺时针
  *
  *     软件配置： 	USART1波特率 115200	 8 - N - 1 
  *				   	TIMER定时器设置2KHz 
  *
  *		PID参数：				P		I		D
  *					YAW			
  *					ROLL		
  *					PITCH		
  * 
  * 	硬件接口:	USART2----TX(PD.5)	RX(PD.6)	
  * 				USART1----TX(PA.9)	RX(PA.10)
  * 				MOTO------1(PA.0)	2(PA.1)	3(PA.2)	4(PA.3)
  * 				PPM_In----THROTTLE(PC.7)	YAW(PC.6)	ROLL(PB.1)	PTICH(PB.0)
  *							  AUX1(PD.13)    AUX2(PD.14)    AUX3(PD.12)    AUX4()    AUX5()    AUX6()
  ******************************************************************************
  */
接收机通道  yaw pitch  thro roll gry pit 
			PC.6  PB.0 PC.7 PB.1 

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
//
//	IMU已弃用										MPU6050.h   接口 	（已弃用）
//
//												void MPU6050_Init(void);	初始化6050
//												u8 MPU6050_Read(void);			初始化读6050原始数据，若iic忙返回 0 若iic触发写成功 返回 1 
//												void MPU6050_Dataanl(void);			将iic读取到得数据分拆,放入相应寄存器
//												
//											IMU.h	接口	（已弃用IMU改用dmp）
//
//												void Prepare_Data(void);	//对原始数据进行滤波
//												void Get_Attitude(void);	//陀螺仪 加速度计  四元数姿态解算 输出欧拉角Q_ANGLE
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////



/******************************改用DMP后的程序函数接口******************************/

control.h  接口

	void CONTROL(float rol, float pit, float yaw);	
	
MPU6050.h  接口

	void IMU_Update(void);		
	
TIM_Pwm_Output.h	接口		TIM5定时器

		定时器TIM5的4个通道PWM输出	PA.0-PA.3	主频四分频42MHz	重装值52500 频率：800Hz
		
Data_Transfer.h	    接口

遥控器接收机接口说明

从右到左依次为 蓝、褐、灰、白、黑、棕、红、橙、黄、绿、蓝、褐
接线按照从右到左，接收机按照从左到右的顺序（由外到内）的顺序接入

遥控器信号线

CH1 灰色 副翼		PE.6
CH2 紫色 油门	    PB.9
CH3 蓝色 升降舵		PE.5
CH4 绿色 方向舵		PB.8

电机信号线

CH1 紫色  1号电机  	PE.9
CH2 蓝色  2号电机 	PE.11
CH3 白色  3号电机 	PE.13
CH4 灰色  4号电机  	PE.14


/******************************校准数据参考******************************/

后仰 pitch++
左倾 roll++
x=+1.85
y=-1.08

-2.50
2.70

x 2.9
y-0.4


x1.8
y-0.1


内环 picth	p 500  d 10

	 yaw	p 
外环 pitch  p 300  d 80
	
	yaw    p 



